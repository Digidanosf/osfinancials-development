CREATE TABLE TRANSACT_BUDGET
(
  WTRANSACTIONID Integer NOT NULL,
  DDATE {timestamptype},
  SREFERENCE varchAr(15),
  SDESCRIPTION Varchar(35),
  FAMOUNT Numeric(12,2) NOT NULL,
  WUSERID Integer,
  DSYSDATE {timestamptype},
  WJOBCODEID Integer,
  BEXCLUSIVE Smallint,
  WREPORTINGGROUP1ID Integer,
  WREPORTINGGROUP2ID Integer,
  WACCOUNTID Integer,
  BLASTYEAR Smallint,
  PRIMARY KEY (WTRANSACTIONID)
) 
;
ALTER TABLE TRANSACT_BUDGET ADD CONSTRAINT FK_TRANSACT_BUDGET_AC
  FOREIGN KEY (WACCOUNTID) REFERENCES ACCOUNT (WACCOUNTID) ON UPDATE CASCADE ON DELETE CASCADE
;
CREATE INDEX IDX_TRANSACTBUDDDATE ON TRANSACT (DDATE)
;
{generator_cr_start}gen_TRANS_BUDGET{generator_cr_end} ;

INSERT INTO TRANSACT_BUDGET (WTRANSACTIONID, DDATE, SREFERENCE, SDESCRIPTION, FAMOUNT, WUSERID, DSYSDATE, WJOBCODEID, BEXCLUSIVE, WREPORTINGGROUP1ID, WREPORTINGGROUP2ID, WACCOUNTID, BLASTYEAR)
SELECT {genstart}GEN_TRANS_BUDGET{genend}, periods.DSTARTDATE,'Conv','Conversion', a.FAMOUNT,0, a.DSYSDATE,null,0,0,0,a.WACCOUNTID,0
FROM TOTALS a join periods on a.WPERIODID = periods.WPERIODID
  where bactual = 0 and famount <> 0
;
delete
FROM TRANSACT_BUDGET a
 where WAccountid in (select Waccountid from account 
where  a.WAccountid = account.waccountid 
and account.BSubaccounts  =1)
;
update Sysvars set WVersion=560
;






