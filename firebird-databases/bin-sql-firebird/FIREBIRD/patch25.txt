DROP VIEW TRANSACTASBATCH;

/**************** DROPPING COMPLETE ***************/
<@MSSQLGO@>
CREATE VIEW TRANSACTASBATCH (WBATCHID, WLINEID, SREFERENCE, DDATE, SDESCRIPTION, WACCOUNTID, SACCOUNT, WCONTRAACCOUNTID, SCONTRAACCOUNT, WTAXID, STAX, FAMOUNT, FDEBIT, FCREDIT, FTAXAMOUNT, DALLOCATEDDATE, BEXCLUSIVE, WLINKEDID, WREPORTINGGROUP1ID, WREPORTINGGROUP2ID, SJOBCODE,WDOCID)
AS    
SELECT 
TRANSACT.WBatchId,
TRANSACT.WLINEID,
TRANSACT.SREFERENCE,
TRANSACT.DDATE,
MESSAGES.SDESCRIPTION,
Mainaccount.WACCOUNTID,
coalesce(Mainaccount.SMAINACCOUNTCODE,''){concat}'-' {concat} coalesce(Mainaccount.SSUBACCOUNTCODE,'') SAccount,
Contra.WACCOUNTID,
coalesce(Contra.SMAINACCOUNTCODE,'') {concat}'-' {concat}coalesce(Contra.SSUBACCOUNTCODE ,'') SContraAccount,
TAX.WACCOUNTID,
coalesce(Tax.SMAINACCOUNTCODE,'') {concat}'-' {concat} coalesce(Tax.SSUBACCOUNTCODE ,'') STaxAccount,
cast(TRANSACT.FAMOUNT as decimal (12,2)),
cast(0 as decimal (12,2)),
cast(0-TRANSACT.FAMOUNT as decimal (12,2)),
TRANSACT.FTAXAMOUNT,
TRANSACT.DDATE,
TRANSACT.BEXCLUSIVE,
TRANSACT.WLINKEDID,
TRANSACT.WREPORTINGGROUP1ID,
TRANSACT.WREPORTINGGROUP2ID,
cast(TRANSACT.WJOBCODEID as char(8)) SJOBCODE,
TRANSACT.WDocid 

FROM TRANSACT 
   left JOIN ACCOUNT Mainaccount ON (TRANSACT.WACCOUNTID = Mainaccount.WACCOUNTID)
   left JOIN MESSAGES ON (TRANSACT.WDESCRIPTIONID = MESSAGES.WMESSAGEID)
   left JOIN ACCOUNT Tax ON (TRANSACT.WTAXACCOUNTID = Tax.WACCOUNTID)
   left JOIN ACCOUNT Contra ON (TRANSACT.WBALANCINGACCOUNTID = Contra.WACCOUNTID)
   JOIN BATTYPES battyp ON (TRANSACT.WBatchTypeID = battyp.WbatchTypeID)
   where famount < 0 and BExclusive = 0 and battyp.BCashBook = 0
   
union
SELECT 
TRANSACT.WBatchId,
TRANSACT.WLINEID,
TRANSACT.SREFERENCE,
TRANSACT.DDATE,
MESSAGES.SDESCRIPTION,
Mainaccount.WACCOUNTID,
coalesce(Mainaccount.SMAINACCOUNTCODE,''){concat}'-' {concat} coalesce(Mainaccount.SSUBACCOUNTCODE,'') SAccount,
Contra.WACCOUNTID,
coalesce(Contra.SMAINACCOUNTCODE,'') {concat}'-' {concat}coalesce(Contra.SSUBACCOUNTCODE ,'') SContraAccount,
TAX.WACCOUNTID,
coalesce(Tax.SMAINACCOUNTCODE,'') {concat}'-' {concat} coalesce(Tax.SSUBACCOUNTCODE ,'') STaxAccount,
cast(TRANSACT.FAMOUNT  - TRANSACT.FTAXAMOUNT as decimal (12,2)),
cast(0 as decimal (12,2)),
cast(0-(TRANSACT.FAMOUNT) as decimal (12,2)),
TRANSACT.FTAXAMOUNT,
TRANSACT.DDATE,
TRANSACT.BEXCLUSIVE,
TRANSACT.WLINKEDID,
TRANSACT.WREPORTINGGROUP1ID,
TRANSACT.WREPORTINGGROUP2ID,
cast(TRANSACT.WJOBCODEID as char(8)) SJOBCODE,
TRANSACT.WDocid 
FROM TRANSACT 
   left JOIN ACCOUNT Mainaccount ON (TRANSACT.WACCOUNTID = Mainaccount.WACCOUNTID)
   left JOIN MESSAGES ON (TRANSACT.WDESCRIPTIONID = MESSAGES.WMESSAGEID)
   left JOIN ACCOUNT Tax ON (TRANSACT.WTAXACCOUNTID = Tax.WACCOUNTID)
   left JOIN ACCOUNT Contra ON (TRANSACT.WBALANCINGACCOUNTID = Contra.WACCOUNTID)
   JOIN BATTYPES battyp ON (TRANSACT.WBatchTypeID = battyp.WbatchTypeID)
   where famount < 0 and BExclusive = 1 and battyp.BCashBook = 0
union
SELECT 
TRANSACT.WBatchId,
TRANSACT.WLINEID,
TRANSACT.SREFERENCE,
TRANSACT.DDATE,
MESSAGES.SDESCRIPTION,
Mainaccount.WACCOUNTID,
coalesce(Mainaccount.SMAINACCOUNTCODE,''){concat}'-' {concat} coalesce(Mainaccount.SSUBACCOUNTCODE,'') SAccount,
Contra.WACCOUNTID,
coalesce(Contra.SMAINACCOUNTCODE,'') {concat}'-' {concat}coalesce(Contra.SSUBACCOUNTCODE ,'') SContraAccount,
TAX.WACCOUNTID,
coalesce(Tax.SMAINACCOUNTCODE,'') {concat}'-' {concat} coalesce(Tax.SSUBACCOUNTCODE ,'') STaxAccount,
cast(TRANSACT.FAMOUNT -TRANSACT.FTAXAMOUNT as decimal (12,2)),
cast(0+(TRANSACT.FAMOUNT) as decimal (12,2)), 
cast(0 as decimal (12,2)),
TRANSACT.FTAXAMOUNT,
TRANSACT.DDATE,
TRANSACT.BEXCLUSIVE,
TRANSACT.WLINKEDID,
TRANSACT.WREPORTINGGROUP1ID,
TRANSACT.WREPORTINGGROUP2ID,
cast(TRANSACT.WJOBCODEID as  char(8)) SJOBCODE,
TRANSACT.WDocid 
FROM TRANSACT 
   left JOIN ACCOUNT Mainaccount ON (TRANSACT.WACCOUNTID = Mainaccount.WACCOUNTID)
   left JOIN MESSAGES ON (TRANSACT.WDESCRIPTIONID = MESSAGES.WMESSAGEID)
   left JOIN ACCOUNT Tax ON (TRANSACT.WTAXACCOUNTID = Tax.WACCOUNTID)
   left JOIN ACCOUNT Contra ON (TRANSACT.WBALANCINGACCOUNTID = Contra.WACCOUNTID)
   JOIN BATTYPES battyp ON (TRANSACT.WBatchTypeID = battyp.WbatchTypeID)
   where famount > 0 and BExclusive = 1 and battyp.BCashBook = 0

union
SELECT 
TRANSACT.WBatchId,
TRANSACT.WLINEID,
TRANSACT.SREFERENCE,
TRANSACT.DDATE,
MESSAGES.SDESCRIPTION,
Mainaccount.WACCOUNTID,
coalesce(Mainaccount.SMAINACCOUNTCODE,''){concat}'-' {concat} coalesce(Mainaccount.SSUBACCOUNTCODE,'') SAccount,
Contra.WACCOUNTID,
coalesce(Contra.SMAINACCOUNTCODE,'') {concat}'-' {concat}coalesce(Contra.SSUBACCOUNTCODE ,'') SContraAccount,
TAX.WACCOUNTID,
coalesce(Tax.SMAINACCOUNTCODE,'') {concat}'-' {concat} coalesce(Tax.SSUBACCOUNTCODE ,'') STaxAccount,
cast(TRANSACT.FAMOUNT as decimal (12,2)),
cast(TRANSACT.FAMOUNT as decimal (12,2)), 
cast(0 as decimal (12,2)),
TRANSACT.FTAXAMOUNT,
TRANSACT.DDATE,
TRANSACT.BEXCLUSIVE,
TRANSACT.WLINKEDID,
TRANSACT.WREPORTINGGROUP1ID,
TRANSACT.WREPORTINGGROUP2ID,
cast(TRANSACT.WJOBCODEID as  char(8)) SJOBCODE,
TRANSACT.WDocid 
FROM TRANSACT 
   left JOIN ACCOUNT Mainaccount ON (TRANSACT.WACCOUNTID = Mainaccount.WACCOUNTID)
   left JOIN MESSAGES ON (TRANSACT.WDESCRIPTIONID = MESSAGES.WMESSAGEID)
   left JOIN ACCOUNT Tax ON (TRANSACT.WTAXACCOUNTID = Tax.WACCOUNTID)
   left JOIN ACCOUNT Contra ON (TRANSACT.WBALANCINGACCOUNTID = Contra.WACCOUNTID)
   JOIN BATTYPES battyp ON (TRANSACT.WBatchTypeID = battyp.WbatchTypeID)
   where famount > 0 and BExclusive = 0 and battyp.BCashBook = 0
union

SELECT 
TRANSACT.WBatchId,
TRANSACT.WLINEID,
TRANSACT.SREFERENCE,
TRANSACT.DDATE,
MESSAGES.SDESCRIPTION,
Mainaccount.WACCOUNTID,
coalesce(Mainaccount.SMAINACCOUNTCODE,''){concat}'-' {concat} coalesce(Mainaccount.SSUBACCOUNTCODE,'') SAccount,
Contra.WACCOUNTID,
coalesce(Contra.SMAINACCOUNTCODE,'') {concat}'-' {concat}coalesce(Contra.SSUBACCOUNTCODE,''),
TAX.WACCOUNTID,
coalesce(Tax.SMAINACCOUNTCODE,'') {concat}'-' {concat} coalesce(Tax.SSUBACCOUNTCODE ,''),
cast(TRANSACT.FAMOUNT + (TRANSACT.FTAXAMOUNT) as decimal (12,2)),
cast(0 as decimal (12,2)),
cast(0-TRANSACT.FAMOUNT as decimal (12,2)),
TRANSACT.FTAXAMOUNT,
TRANSACT.DDATE,
TRANSACT.BEXCLUSIVE,
TRANSACT.WLINKEDID,
TRANSACT.WREPORTINGGROUP1ID,
TRANSACT.WREPORTINGGROUP2ID,
cast(TRANSACT.WJOBCODEID as  char(8)) SJOBCODE,
TRANSACT.WDocid 
FROM TRANSACT 
   left JOIN ACCOUNT Mainaccount ON (TRANSACT.WACCOUNTID = Mainaccount.WACCOUNTID)
   left JOIN MESSAGES ON (TRANSACT.WDESCRIPTIONID = MESSAGES.WMESSAGEID)
   left JOIN ACCOUNT Tax ON (TRANSACT.WTAXACCOUNTID = Tax.WACCOUNTID)
   left JOIN ACCOUNT Contra ON (TRANSACT.WBALANCINGACCOUNTID = Contra.WACCOUNTID)
   JOIN BATTYPES battyp ON (TRANSACT.WBatchTypeID = battyp.WbatchTypeID)
   where famount < 0 and BExclusive = 0 and battyp.BCashBook = 1
union
SELECT 
TRANSACT.WBatchId,
TRANSACT.WLINEID,
TRANSACT.SREFERENCE,
TRANSACT.DDATE,
MESSAGES.SDESCRIPTION,
Mainaccount.WACCOUNTID,
coalesce(Mainaccount.SMAINACCOUNTCODE,''){concat}'-' {concat} coalesce(Mainaccount.SSUBACCOUNTCODE,'') SAccount,
Contra.WACCOUNTID,
coalesce(Contra.SMAINACCOUNTCODE,'') {concat}'-' {concat}coalesce(Contra.SSUBACCOUNTCODE ,''),
TAX.WACCOUNTID,
coalesce(Tax.SMAINACCOUNTCODE,'') {concat}'-' {concat} coalesce(Tax.SSUBACCOUNTCODE ,''),
cast(TRANSACT.FAMOUNT as decimal (12,2)),
cast(0 as decimal (12,2)),
cast(0-(TRANSACT.FAMOUNT) as decimal (12,2)),
TRANSACT.FTAXAMOUNT,
TRANSACT.DDATE,
TRANSACT.BEXCLUSIVE,
TRANSACT.WLINKEDID,
TRANSACT.WREPORTINGGROUP1ID,
TRANSACT.WREPORTINGGROUP2ID,
cast(TRANSACT.WJOBCODEID as  char(8)) SJOBCODE,
TRANSACT.WDocid 
FROM TRANSACT 
   left JOIN ACCOUNT Mainaccount ON (TRANSACT.WACCOUNTID = Mainaccount.WACCOUNTID)
   left JOIN MESSAGES ON (TRANSACT.WDESCRIPTIONID = MESSAGES.WMESSAGEID)
   left JOIN ACCOUNT Tax ON (TRANSACT.WTAXACCOUNTID = Tax.WACCOUNTID)
   left JOIN ACCOUNT Contra ON (TRANSACT.WBALANCINGACCOUNTID = Contra.WACCOUNTID)
   JOIN BATTYPES battyp ON (TRANSACT.WBatchTypeID = battyp.WbatchTypeID)
   where famount < 0 and BExclusive = 1 and battyp.BCashBook = 1
union
SELECT 
TRANSACT.WBatchId,
TRANSACT.WLINEID,
TRANSACT.SREFERENCE,
TRANSACT.DDATE,
MESSAGES.SDESCRIPTION,
Mainaccount.WACCOUNTID,
coalesce(Mainaccount.SMAINACCOUNTCODE,''){concat}'-' {concat} coalesce(Mainaccount.SSUBACCOUNTCODE,'') SAccount,
Contra.WACCOUNTID,
coalesce(Contra.SMAINACCOUNTCODE,'') {concat}'-' {concat}coalesce(Contra.SSUBACCOUNTCODE ,''),
TAX.WACCOUNTID,
coalesce(Tax.SMAINACCOUNTCODE,'') {concat}'-' {concat} coalesce(Tax.SSUBACCOUNTCODE ,''),
TRANSACT.FAMOUNT,
cast(0+(TRANSACT.FAMOUNT) as decimal (12,2)), 
cast(0 as decimal (12,2)),
TRANSACT.FTAXAMOUNT,
TRANSACT.DDATE,
TRANSACT.BEXCLUSIVE,
TRANSACT.WLINKEDID,
TRANSACT.WREPORTINGGROUP1ID,
TRANSACT.WREPORTINGGROUP2ID,
cast(TRANSACT.WJOBCODEID as char(8)) SJOBCODE,
TRANSACT.WDocid 
FROM TRANSACT 
   left JOIN ACCOUNT Mainaccount ON (TRANSACT.WACCOUNTID = Mainaccount.WACCOUNTID)
   left JOIN MESSAGES ON (TRANSACT.WDESCRIPTIONID = MESSAGES.WMESSAGEID)
   left JOIN ACCOUNT Tax ON (TRANSACT.WTAXACCOUNTID = Tax.WACCOUNTID)
   left JOIN ACCOUNT Contra ON (TRANSACT.WBALANCINGACCOUNTID = Contra.WACCOUNTID)
   JOIN BATTYPES battyp ON (TRANSACT.WBatchTypeID = battyp.WbatchTypeID)
   where famount > 0 and BExclusive = 1 and battyp.BCashBook = 1
union
SELECT 
TRANSACT.WBatchId,
TRANSACT.WLINEID,
TRANSACT.SREFERENCE,
TRANSACT.DDATE,
MESSAGES.SDESCRIPTION,
Mainaccount.WACCOUNTID,
coalesce(Mainaccount.SMAINACCOUNTCODE,''){concat}'-' {concat} coalesce(Mainaccount.SSUBACCOUNTCODE,'') SAccount,
Contra.WACCOUNTID,
coalesce(Contra.SMAINACCOUNTCODE,'') {concat}'-' {concat}coalesce(Contra.SSUBACCOUNTCODE,''),
TAX.WACCOUNTID,
coalesce(Tax.SMAINACCOUNTCODE,'') {concat}'-' {concat} coalesce(Tax.SSUBACCOUNTCODE ,''),
cast(TRANSACT.FAMOUNT+TRANSACT.FTAXAMOUNT as decimal (12,2)),
cast(TRANSACT.FAMOUNT as decimal (12,2)), 
cast(0 as decimal (12,2)),
TRANSACT.FTAXAMOUNT,
TRANSACT.DDATE,
TRANSACT.BEXCLUSIVE,
TRANSACT.WLINKEDID,
TRANSACT.WREPORTINGGROUP1ID,
TRANSACT.WREPORTINGGROUP2ID,
cast(TRANSACT.WJOBCODEID as  char(8)) SJOBCODE,
TRANSACT.WDocid 
FROM TRANSACT 
   left JOIN ACCOUNT Mainaccount ON (TRANSACT.WACCOUNTID = Mainaccount.WACCOUNTID)
   left JOIN MESSAGES ON (TRANSACT.WDESCRIPTIONID = MESSAGES.WMESSAGEID)
   left JOIN ACCOUNT Tax ON (TRANSACT.WTAXACCOUNTID = Tax.WACCOUNTID)
   left JOIN ACCOUNT Contra ON (TRANSACT.WBALANCINGACCOUNTID = Contra.WACCOUNTID)
   JOIN BATTYPES battyp ON (TRANSACT.WBatchTypeID = battyp.WbatchTypeID)
   where famount > 0 and BExclusive = 0 and battyp.BCashBook = 1 
; 
<@MSSQLGO@>
update Sysvars set WVersion=528
;




